# typed: false
# frozen_string_literal: true

# This file was generated by GoReleaser. DO NOT EDIT.
class Resticprofile < Formula
  desc "Configuration profiles for restic backup"
  homepage "https://github.com/creativeprojects/resticprofile"
  version "0.16.1"
  license "GPL-3.0-only"

  on_macos do
    if Hardware::CPU.intel?
      url "https://github.com/creativeprojects/resticprofile/releases/download/v0.16.1/resticprofile_0.16.1_darwin_amd64.tar.gz"
      sha256 "fc8734730fc42f4da670cf999f1245227988ac45477fa046f855d9d929502424"

      def install
        bin.install "resticprofile"
      end
    end
    if Hardware::CPU.arm?
      url "https://github.com/creativeprojects/resticprofile/releases/download/v0.16.1/resticprofile_0.16.1_darwin_arm64.tar.gz"
      sha256 "5aaf18eb8a9f5d33f20e930bfb18727bdf4d326cf49eea564e3ed6589138a309"

      def install
        bin.install "resticprofile"
      end
    end
  end

  on_linux do
    if Hardware::CPU.arm? && !Hardware::CPU.is_64_bit?
      url "https://github.com/creativeprojects/resticprofile/releases/download/v0.16.1/resticprofile_0.16.1_linux_armv6.tar.gz"
      sha256 "f9834cc297ccd9a783af8b3e68b6e824d5cebabb3b0e9fbdbb13e0b3c351a3c3"

      def install
        bin.install "resticprofile"
      end
    end
    if Hardware::CPU.intel?
      url "https://github.com/creativeprojects/resticprofile/releases/download/v0.16.1/resticprofile_0.16.1_linux_amd64.tar.gz"
      sha256 "eb5da8d0203171e8b87dd5818fad1804d1bf4b08b5170588d704e49ded669293"

      def install
        bin.install "resticprofile"
      end
    end
    if Hardware::CPU.arm? && Hardware::CPU.is_64_bit?
      url "https://github.com/creativeprojects/resticprofile/releases/download/v0.16.1/resticprofile_0.16.1_linux_arm64.tar.gz"
      sha256 "d449b2492ecdc1f8565dd7172efa75d03d869f2bebdad4772db6d7cc4a38624f"

      def install
        bin.install "resticprofile"
      end
    end
  end

  head "https://github.com/creativeprojects/resticprofile.git"

  depends_on "restic" => :optional

  test do
    (testpath/"restic_repo").mkdir
    (testpath/"password.txt").write("key")
    (testpath/"profiles.yaml").write <<~EOS
      default:
        repository: "local:#{testpath}/restic_repo"
        password-file: "password.txt"
        initialize: true
    EOS

    (testpath/"testfile").write("This is a testfile")

    system "#{bin}/resticprofile", "backup", "testfile"
    system "#{bin}/resticprofile", "restore", "latest", "-t", "#{testpath}/restore"
    assert compare_file "testfile", "#{testpath}/restore/testfile"
  end
end
