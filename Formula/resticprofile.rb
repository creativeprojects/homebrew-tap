# typed: false
# frozen_string_literal: true

# This file was generated by GoReleaser. DO NOT EDIT.
class Resticprofile < Formula
  desc "Configuration profiles for restic backup"
  homepage "https://github.com/creativeprojects/resticprofile"
  version "0.18.0"
  license "GPL-3.0-only"

  depends_on "restic" => :optional

  on_macos do
    if Hardware::CPU.arm?
      url "https://github.com/creativeprojects/resticprofile/releases/download/v0.18.0/resticprofile_0.18.0_darwin_arm64.tar.gz"
      sha256 "7a2010f012090855484dae1beb3b16776f47f66d5960ac07b33c8d6c78146f09"

      def install
        bin.install "resticprofile"
      end
    end
    if Hardware::CPU.intel?
      url "https://github.com/creativeprojects/resticprofile/releases/download/v0.18.0/resticprofile_0.18.0_darwin_amd64.tar.gz"
      sha256 "df520c6b93a10fcd353145a245e128d2b4b43c1e8169b5d2be657434f633f4d1"

      def install
        bin.install "resticprofile"
      end
    end
  end

  on_linux do
    if Hardware::CPU.arm? && Hardware::CPU.is_64_bit?
      url "https://github.com/creativeprojects/resticprofile/releases/download/v0.18.0/resticprofile_0.18.0_linux_arm64.tar.gz"
      sha256 "1474316e7c55b44c34010f21762b5451b7552595a6bef75955642a45d635d8b9"

      def install
        bin.install "resticprofile"
      end
    end
    if Hardware::CPU.arm? && !Hardware::CPU.is_64_bit?
      url "https://github.com/creativeprojects/resticprofile/releases/download/v0.18.0/resticprofile_0.18.0_linux_armv6.tar.gz"
      sha256 "bb6d2de3c72527e3fa213878490d0969e9b2bf88c02c3d50b1c402472bb07a87"

      def install
        bin.install "resticprofile"
      end
    end
    if Hardware::CPU.intel?
      url "https://github.com/creativeprojects/resticprofile/releases/download/v0.18.0/resticprofile_0.18.0_linux_amd64.tar.gz"
      sha256 "1e929d9748341b3907f74b505db98963e6d0040607209b5cd4db2a5ecbbc0619"

      def install
        bin.install "resticprofile"
      end
    end
  end

  head "https://github.com/creativeprojects/resticprofile.git"

  test do
    (testpath/"restic_repo").mkdir
    (testpath/"password.txt").write("key")
    (testpath/"profiles.yaml").write <<~EOS
      default:
        repository: "local:#{testpath}/restic_repo"
        password-file: "password.txt"
        initialize: true
    EOS

    (testpath/"testfile").write("This is a testfile")

    system "#{bin}/resticprofile", "backup", "testfile"
    system "#{bin}/resticprofile", "restore", "latest", "-t", "#{testpath}/restore"
    assert compare_file "testfile", "#{testpath}/restore/testfile"
  end
end
